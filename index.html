<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWise - Yeovil Forecast & More</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db; 
            --secondary-color: #2ecc71; 
            --dark-color: #2c3e50;    
            --light-color: #f4f6f7;   
            --surface-color: #ffffff; 
            --accent-color: #5dade2;  
            --border-color: #e0e0e0;
            --text-color-base: #2c3e50; 
            --text-muted-base: #7f8c8d; 
            
            --border-radius-md: 8px;
            --border-radius-lg: 12px;

            --padding-xl: 40px;
            --padding-lg: 24px;
            --padding-md: 16px;
            --padding-sm: 12px;
            --padding-xs: 8px;

            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--light-color);
            color: var(--text-color-base);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--padding-md);
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: var(--padding-sm) 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000; 
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px; 
        }

        .logo {
            font-size: 26px;
            font-weight: 700;
            display: flex;
            align-items: center;
            transition: transform 0.3s ease; 
        }
        .logo:hover {
            transform: scale(1.05); 
        }
        .logo i {
            margin-right: 10px;
            font-size: 28px;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
        }
        .logo:hover i {
            transform: rotate(15deg) scale(1.1); 
        }

        nav ul {
            display: flex;
            list-style: none;
            align-items: center;
        }
        nav ul li {
            margin-left: 20px;
        }
        nav ul li:last-child { /* Unit toggle button */
            margin-left: 15px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease, opacity 0.3s ease; 
            position: relative;
            padding: 5px 0; 
        }
        nav ul li a:hover {
            opacity: 0.8;
            color: var(--light-color); 
        }
        nav ul li a::after { 
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--light-color); 
            opacity: 0.8;
            bottom: 0; 
            left: 50%;
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }
        nav ul li a:hover::after {
            width: 100%;
        }
        nav ul li a.active-nav-link {
            color: var(--secondary-color) !important; 
            font-weight: 700;
        }
        nav ul li a.active-nav-link::after {
            width: 100%; 
            background: var(--secondary-color) !important;
        }


        .unit-toggle-btn {
            background-color: rgba(255, 255, 255, 0.2); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 6px 12px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, transform 0.2s ease;
            min-width: 50px;
            text-align: center;
        }
        .unit-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        .unit-toggle-btn:active {
            transform: scale(0.98);
        }

        /* Hero Section */
        .hero {
            padding: 120px 0 80px; 
            background-color: var(--dark-color); 
            background-size: cover;
            background-position: center center; 
            background-repeat: no-repeat;
            position: relative; 
            color: white;
            text-align: center;
            margin-top: 60px; 
            overflow: hidden; 
            transition: background-image 0.8s ease-in-out, background-color 0.8s ease-in-out;
        }
        .hero::before { 
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(44, 62, 80, 0.55); 
            z-index: 0; 
            transition: background-color 0.8s ease-in-out;
        }
        .hero-content { 
            position: relative; 
            z-index: 1;    
            max-width: 700px; 
            margin: 0 auto;
        }
        .hero h1 {
            font-size: 38px; 
            margin-bottom: var(--padding-md); 
            animation: fadeIn 1s ease-in;
            font-weight: 600;
        }
        .hero p.tagline {
            font-size: 17px; 
            margin-bottom: var(--padding-lg);
            animation: fadeIn 1s ease-in 0.3s both;
            opacity: 0.9;
        }

        .search-form-wrapper {
            position: relative; 
            max-width: 600px; 
            margin: 0 auto;
            animation: fadeIn 1s ease-in 0.6s both;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: var(--padding-md); 
        }
        .search-form-container {
            display: flex;
            border-radius: 30px; 
            overflow: visible; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); 
            width: 100%; 
            max-width: 500px; 
            position: relative; 
            z-index: 2; 
        }
        #locationInput {
            flex-grow: 1;
            padding: 15px 20px; 
            font-size: 16px; 
            border: 1px solid var(--border-color); 
            border-right: none; 
            border-top-left-radius: 30px;
            border-bottom-left-radius: 30px;
            outline: none;
            color: var(--text-color-base);
            background-color: var(--surface-color);
            transition: box-shadow 0.3s ease; 
        }
        #locationInput:focus {
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        #searchButton { 
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 30px; 
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px; 
            border-top-right-radius: 30px;
            border-bottom-right-radius: 30px;
            transition: background-color 0.3s ease, transform 0.2s ease; 
            display: flex; 
            align-items: center;
            gap: 8px; 
        }
        #searchButton:hover {
            background-color: #27ae60; 
            transform: scale(1.02);
        }
        #searchButton:active {
            transform: scale(0.98);
        }
        #searchButton i { 
            transition: transform 0.3s ease;
        }
        #searchButton:hover i {
            transform: translateX(3px) scale(1.1); 
        }

        .autocomplete-suggestions-container {
            position: absolute;
            top: calc(100% + 5px - var(--padding-md)); 
            left: 50%; 
            transform: translateX(-50%);
            width: 100%; 
            max-width: 500px; 
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-top: none;
            border-bottom-left-radius: var(--border-radius-md);
            border-bottom-right-radius: var(--border-radius-md);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            z-index: 999; 
            max-height: 250px; 
            overflow-y: auto;
            display: none;
        }

        .autocomplete-suggestions-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .autocomplete-suggestions-container li {
            padding: var(--padding-sm) var(--padding-md);
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
            color: var(--text-color-base);
            transition: background-color 0.2s ease;
        }
        .autocomplete-suggestions-container li:last-child {
            border-bottom: none;
        }
        .autocomplete-suggestions-container li:hover,
        .autocomplete-suggestions-container li.active-suggestion {
            background-color: var(--light-color);
        }
        .autocomplete-suggestions-container li strong { 
            font-weight: 700;
            color: var(--primary-color);
        }


        .search-input-error {
            color: #f1c40f; 
            font-size: 0.9rem; 
            height: 1.2em; 
            line-height: 1.2em;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            font-weight: 500;
            text-shadow: 0px 0px 1px rgba(0, 0, 0, 0.2); 
            width: 100%; 
            max-width: 500px; 
        }
        .search-input-error.visible {
            opacity: 1;
        }

        .geolocation-btn {
            background-color: transparent; 
            color: white; 
            border: 1px solid rgba(255, 255, 255, 0.7); 
            padding: 10px 20px; 
            border-radius: 25px; 
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem; 
            display: inline-flex; 
            align-items: center;
            gap: 8px; 
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        }
        .geolocation-btn:hover {
            background-color: rgba(255, 255, 255, 0.15); 
            transform: scale(1.03);
        }
        .geolocation-btn:active {
            transform: scale(0.99);
            background-color: rgba(255, 255, 255, 0.1);
        }
        .geolocation-btn i {
            font-size: 1rem; 
        }
        .geolocation-btn:disabled {
            opacity: 0.7; 
            cursor: not-allowed;
        }
        
        .geolocation-btn > i,
        .geolocation-btn > .btn-text {
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            display: inline-flex; 
            align-items: center;
        }

        .geolocation-btn.geolocation-btn--loading > i,
        .geolocation-btn.geolocation-btn--loading > .btn-text {
            opacity: 0;
            visibility: hidden; 
        }

        .geolocation-btn.geolocation-btn--loading {
            position: relative; 
        }

        .geolocation-btn.geolocation-btn--loading::after { 
            content: "";
            box-sizing: border-box; 
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px; 
            height: 20px; 
            margin-top: -10px; 
            margin-left: -10px; 
            border: 3px solid rgba(255, 255, 255, 0.35); 
            border-top-color: #ffffff; 
            border-radius: 50%;
            animation: btnSpinAnimation 0.7s linear infinite;
        }

        @keyframes btnSpinAnimation {
            to {
                transform: rotate(360deg);
            }
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loader-container { 
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--padding-xl) 0; 
            width: 100%;
            grid-column: 1 / -1; 
        }
        .loader {
            border: 6px solid var(--light-color); 
            border-top: 6px solid var(--primary-color); 
            border-radius: 50%;
            width: 50px; 
            height: 50px; 
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Skeleton Loader Styles */
        .skeleton-placeholder { width: 100%; }
        .skeleton-line-large, .skeleton-line-medium, .skeleton-line-small, .skeleton-line-xsmall,
        .skeleton-icon-main, .skeleton-icon-medium, .skeleton-icon-small,
        .skeleton-block {
            background-color: #e0e0e0;
            border-radius: var(--border-radius-md);
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }
        .skeleton-line-large::before, .skeleton-line-medium::before, .skeleton-line-small::before, .skeleton-line-xsmall::before,
        .skeleton-icon-main::before, .skeleton-icon-medium::before, .skeleton-icon-small::before,
        .skeleton-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: -150%;
            height: 100%;
            width: 150%;
            background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.5) 50%, transparent 100%);
            animation: shimmer 1.5s infinite linear;
        }
        @keyframes shimmer { 0% { transform: translateX(0); } 100% { transform: translateX(100%); } }
        .skeleton-line-large { height: 40px; width: 60%; margin-left: auto; margin-right: auto;}
        .skeleton-line-medium { height: 20px; width: 80%; }
        .skeleton-line-small { height: 16px; width: 90%; }
        .skeleton-line-xsmall { height: 12px; width: 70%; }
        .skeleton-icon-main { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto var(--padding-md) auto; }
        .skeleton-icon-medium { width: 50px; height: 50px; border-radius: var(--border-radius-md); margin: var(--padding-xs) auto; }
        .skeleton-icon-small { width: 40px; height: 40px; border-radius: var(--border-radius-md); margin: var(--padding-xs) auto; }
        .skeleton-block { height: 100px; width: 100%; }
        .skeleton-current-weather { background-color: var(--surface-color); padding: var(--padding-lg); border-radius: var(--border-radius-lg); box-shadow: 0 8px 25px rgba(44, 62, 80, 0.1); display: grid; grid-template-columns: auto 1fr; gap: var(--padding-lg); align-items: center; }
        .skeleton-current-weather .skeleton-details-main { display: flex; flex-direction: column; align-items: center; }
        @media (max-width: 768px) { .skeleton-current-weather { grid-template-columns: 1fr; text-align: center; } }
        .skeleton-current-weather .skeleton-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--padding-sm); }
        .skeleton-hourly-card-container { display: flex; overflow-x: auto; padding: var(--padding-md) 0; gap: var(--padding-md); }
        .skeleton-hourly-card { min-width: 100px; padding: var(--padding-md); background-color: var(--light-color); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); text-align: center; box-shadow: 0 3px 8px rgba(0,0,0,0.05); }
        .skeleton-hourly-card .skeleton-line-xsmall, .skeleton-hourly-card .skeleton-line-small { margin-left: auto; margin-right: auto; }
        .skeleton-forecast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--padding-md); }
        .skeleton-forecast-card { background-color: var(--surface-color); padding: var(--padding-md); border-radius: var(--border-radius-lg); text-align: center; box-shadow: 0 5px 15px rgba(44, 62, 80, 0.08); }
        .skeleton-forecast-card .skeleton-line-small, .skeleton-forecast-card .skeleton-line-medium { margin-left: auto; margin-right: auto; }
        .loader-container.hidden-by-skeleton { display: none !important; }


        .weather-results-area {
            padding: var(--padding-xl) 0; 
            background-color: var(--light-color); 
            opacity: 0;
            transform: translateY(30px); 
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; 
            visibility: hidden; 
        }
        .weather-results-area.visible { 
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .section-title { 
            text-align: center;
            margin-bottom: var(--padding-lg); 
        }
        .section-title h2 {
            font-size: 32px; 
            color: var(--dark-color);
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
            font-weight: 600;
        }
        .section-title h2::after { 
            content: '';
            position: absolute;
            width: 70px;
            height: 3px;
            background-color: var(--primary-color);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            transition: width 0.3s ease-in-out;
        }
        #locationHeader {
             margin-bottom: var(--padding-lg); 
        }
        .section-subtitle { 
            font-size: 1.5rem; 
            color: var(--primary-color);
            text-align: center;
            margin-bottom: var(--padding-md);
            font-weight: 500; 
        }

        #currentWeatherCard {
            background-color: var(--surface-color);
            padding: var(--padding-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 25px rgba(44, 62, 80, 0.1); 
            margin-bottom: var(--padding-xl); 
            display: grid;
            grid-template-columns: auto 1fr; 
            gap: var(--padding-lg);
            align-items: center;
            transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease; 
            overflow: hidden; 
            border: 2px solid transparent; 
        }
        #currentWeatherCard:hover {
            transform: translateY(-7px) scale(1.015); 
            box-shadow: 0 16px 38px rgba(44, 62, 80, 0.16);
            border-color: var(--accent-color); 
        }
        #currentWeatherCard .weather-icon-temp,
        #currentWeatherCard .current-details-grid {
            opacity: 0;
            transform: translateY(20px); 
            transition: opacity 0.5s ease-out 0.1s, transform 0.5s ease-out 0.1s;
        }
        #currentWeatherCard.content-visible .weather-icon-temp {
            opacity: 1; transform: translateY(0);
            transition-delay: 0.2s; 
        }
        #currentWeatherCard.content-visible .current-details-grid {
            opacity: 1; transform: translateY(0);
            transition-delay: 0.35s; 
        }

        #currentWeatherCard img.current-icon {
            width: 100px; 
            height: 100px; 
            margin-bottom: var(--padding-sm); 
            transition: transform 0.35s ease;
        }
        #currentWeatherCard:hover img.current-icon { 
            transform: scale(1.1); 
        }
        #currentWeatherCard .current-temperature {
            font-size: 3.5rem; 
            font-weight: bold;
            color: var(--text-color-base);
            line-height: 1;
        }
        #currentWeatherCard .current-temperature sup {
            font-size: 1.5rem;
        }
        #currentWeatherCard .current-condition {
            font-size: 1.2rem; 
            color: var(--primary-color);
            font-weight: 500;
            text-transform: capitalize;
            margin-top: var(--padding-xs); 
        }
        .current-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: var(--padding-sm) var(--padding-md); 
        }
        .current-details-grid p {
            font-size: 0.95rem; 
            color: var(--text-muted-base); 
            background-color: var(--light-color); 
            padding: var(--padding-sm); 
            border-radius: var(--border-radius-md); 
            border: 1px solid var(--border-color); 
            transition: background-color 0.25s ease, box-shadow 0.25s ease, transform 0.25s ease; 
            display: flex; 
            align-items: center; 
        }
        .current-details-grid p:hover { 
            background-color: var(--surface-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transform: translateY(-2px); 
        }
        .current-details-grid p strong {
            color: var(--text-color-base);
            font-weight: 500;
            margin-right: 5px;
        }
        .current-details-grid p > i.fas,
        .current-details-grid p > i.far,
        .current-details-grid p > i.fa-solid {
            margin-right: 8px; 
            font-size: 1em;  
            vertical-align: -0.1em; 
            width: 1.25em; 
            text-align: center; 
        }
        .current-details-grid p i.fa-sunrise { color: #f39c12; }
        .current-details-grid p i.fa-sunset { color: #e67e22; }
        .current-details-grid p i.fa-smog { color: #7f8c8d; }


        /* AQI Text Color Classes */
        .aqi-good { color: #2ecc71; } 
        .aqi-moderate { color: #f1c40f; } 
        .aqi-unhealthy-sensitive { color: #e67e22; } 
        .aqi-unhealthy { color: #e74c3c; } 
        .aqi-very-unhealthy { color: #9b59b6; } 
        .aqi-hazardous { color: #78281f; } 
        .aqi-na { color: var(--text-muted-base); }


        .hourly-forecast-section {
            margin-top: var(--padding-xl); 
            margin-bottom: var(--padding-xl); 
            background-color: var(--surface-color); 
            padding: var(--padding-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 25px rgba(44, 62, 80, 0.08); 
        }
        .hourly-forecast-container {
            display: flex; 
            overflow-x: auto; 
            overflow-y: hidden; 
            padding: var(--padding-md) 0; 
            gap: var(--padding-md); 
            white-space: nowrap; 
            scrollbar-width: thin; 
            scrollbar-color: var(--primary-color) var(--light-color); 
        }
        .hourly-forecast-container::-webkit-scrollbar { height: 8px; } 
        .hourly-forecast-container::-webkit-scrollbar-track { background: var(--light-color); border-radius: 4px; }
        .hourly-forecast-container::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 4px; border: 2px solid var(--light-color); }
        .hourly-forecast-container::-webkit-scrollbar-thumb:hover { background-color: var(--accent-color); }
        .hourly-card {
            display: inline-flex; 
            flex-direction: column;
            align-items: center;
            justify-content: space-around; 
            min-width: 100px; 
            padding: var(--padding-md); 
            background-color: var(--light-color); 
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05); 
            opacity: 0;
            transform: translateY(15px) scale(0.95); 
            transition: opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.25s ease-out, background-color 0.2s ease; 
            cursor: pointer; 
        }
        .hourly-card.visible { opacity: 1; transform: translateY(0) scale(1); }
        .hourly-card:hover { 
            transform: translateY(-5px) scale(1.04); 
            box-shadow: 0 7px 18px rgba(0,0,0,0.1); 
            background-color: var(--surface-color); 
        } 
        .hourly-card .time { font-size: 0.9rem; font-weight: 600; color: var(--text-color-base); margin-bottom: var(--padding-xs); } 
        .hourly-card img.condition-icon { width: 40px; height: 40px; margin: var(--padding-xs) 0; } 
        .hourly-card .temp { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); margin-bottom: var(--padding-xs); } 
        .hourly-card .chance-of-rain { font-size: 0.75rem; color: var(--text-muted-base); } 
        .hourly-loader-placeholder { min-height: 150px; width: 100%; } 

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: var(--padding-md);
        }
        .forecast-card { 
            background-color: var(--surface-color);
            padding: var(--padding-md);
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.08); 
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
            opacity: 0;
            transform: translateY(25px); 
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, box-shadow 0.3s ease; 
            position: relative; 
            overflow: hidden; 
        }
        .forecast-card.visible { 
            opacity: 1;
            transform: translateY(0);
        }
        .forecast-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%; 
            transform: translateX(-50%);
            width: 0; 
            height: 3px; 
            background-color: var(--secondary-color); 
            transition: width 0.3s ease-in-out;
        }
        .forecast-card:hover {
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(44, 62, 80, 0.12); 
        }
        .forecast-card:hover::after {
            width: 70%; 
        }
        .forecast-card .date { 
            font-size: 1rem; 
            font-weight: 600;
            color: var(--text-color-base); 
            margin-bottom: var(--padding-xs);
            position: relative; 
            z-index: 1;
        }
        .forecast-card img.forecast-icon {
            width: 55px; 
            height: 55px; 
            margin: var(--padding-xs) auto;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            position: relative; 
            z-index: 1;
        }
        .forecast-card:hover img.forecast-icon { 
             transform: scale(1.15) translateY(-3px); 
        }
        .forecast-card .temperature {
            font-size: 1.5rem; 
            font-weight: bold;
            color: var(--primary-color);
            margin: var(--padding-xs) 0;
        }
        .forecast-card .condition {
            font-size: 0.85rem; 
            color: var(--text-muted-base);
            text-transform: capitalize;
            margin-bottom: var(--padding-xs);
            flex-grow: 1;
        }
        .forecast-card .min-max {
            font-size: 0.8rem; 
            color: var(--text-muted-base);
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .forecast-card .min-max i.fas {
            margin-right: 3px;
            margin-left: 5px;
            font-size: 0.9em; 
        }
        .forecast-card .min-max i.fas:first-of-type {
            margin-left: 0;
        }
        .forecast-card .chance-of-rain i.fas {
             margin-right: 4px;
             font-size: 0.9em;
        }
        
        /* Weather Alerts Styling */
        .weather-alerts-container {
            margin-bottom: var(--padding-lg);
            padding: var(--padding-md);
            background-color: var(--surface-color);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.08);
        }

        .alerts-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .alert-item {
            padding: var(--padding-md);
            margin-bottom: var(--padding-md);
            border-radius: var(--border-radius-md);
            border-left: 5px solid var(--primary-color); 
            background-color: var(--light-color);
        }
        .alert-item:last-child {
            margin-bottom: 0;
        }

        .alert-item .alert-headline {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin-bottom: var(--padding-xs);
            display: flex;
            align-items: center;
        }
        .alert-item .alert-headline i {
            margin-right: 10px;
            color: var(--primary-color); 
        }

        .alert-item p {
            font-size: 0.9rem;
            color: var(--text-muted-base);
            margin-bottom: var(--padding-xs);
            line-height: 1.5;
        }
        .alert-item p:last-child {
            margin-bottom: 0;
        }
        .alert-item .alert-description {
            color: var(--text-color-base); 
        }
        .alert-item .alert-instruction {
            font-style: italic;
        }
        .alert-item .alert-areas strong {
            color: var(--text-color-base);
        }

        .alert-severity-minor { border-left-color: #f1c40f; }
        .alert-severity-minor .alert-headline i { color: #f1c40f; }
        .alert-severity-moderate { border-left-color: #e67e22; }
        .alert-severity-moderate .alert-headline i { color: #e67e22; }
        .alert-severity-severe { border-left-color: #e74c3c; background-color: #fdedec; }
        .alert-severity-severe .alert-headline i { color: #e74c3c; }
        .alert-severity-extreme { border-left-color: #c0392b; background-color: #fadbd8; }
        .alert-severity-extreme .alert-headline i { color: #c0392b; }


        /* Status Message Container (Toast-like) */
        .status-message-container {
            text-align: center;
            position: fixed; 
            bottom: 20px;    
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000; 
            width: auto;   
            max-width: 90%;
        }
        .status-message, .error-message, .info-message, .success-message { 
            font-size: 1rem; 
            color: white; 
            opacity: 0; 
            padding: var(--padding-md); 
            border-radius: var(--border-radius-md);
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            margin-top: var(--padding-sm); 
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(20px); 
        }
        .status-message-container.visible .status-message,
        .status-message-container.visible .error-message,
        .status-message-container.visible .info-message,
        .status-message-container.visible .success-message {
            transform: translateY(0);
            opacity: 0.95;
        }

        .error-message { background-color: #e74c3c; }
        .success-message { background-color: var(--secondary-color); }
        .info-message { background-color: var(--primary-color); }
        .status-message { background-color: var(--dark-color); }


        /* Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 2000; 
            padding: 15px; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s; 
            overflow-y: auto; 
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s; 
            transition: opacity 0.3s ease-in-out;
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: var(--padding-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 5px 25px rgba(0,0,0,0.2); 
            width: 100%; 
            max-width: 480px; 
            position: relative; 
            max-height: 70vh; 
            overflow-y: auto; 
            transform: translateY(-20px) scale(0.95); 
            opacity: 0; 
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.25s ease-out;
        }
        .modal-overlay.visible .modal-content {
            transform: translateY(0) scale(1); 
            opacity: 1; 
        }

        .modal-close-btn {
            position: absolute;
            top: 8px;  
            right: 8px; 
            background: var(--light-color); 
            border: none;
            border-radius: 50%; 
            width: 32px;  
            height: 32px; 
            font-size: 1.5rem; 
            color: var(--text-muted-base);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
        }
        .modal-close-btn:hover {
            background-color: var(--border-color);
            color: var(--dark-color);
            transform: scale(1.1);
        }

        .modal-title {
            font-size: 1.4rem; 
            color: var(--primary-color);
            margin-bottom: var(--padding-md);
            text-align: center;
            padding-right: 35px; 
            padding-left: 5px; 
            word-break: break-word; 
        }

        .modal-details-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 10px; 
        }
        @media (min-width: 400px) { 
            /* .modal-details-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            } */
            /* Keeping 1 column for now, uncomment if 2 columns preferred on larger modal */
        }

        .modal-details-grid p {
            background-color: var(--light-color);
            padding: var(--padding-sm); 
            border-radius: var(--border-radius-md);
            font-size: 0.9rem;
            color: var(--text-muted-base);
            display: flex; 
            align-items: center;
            border: 1px solid var(--border-color); 
            word-break: break-word; 
        }
        .modal-details-grid p strong {
            color: var(--text-color-base);
            margin-right: 5px;
            white-space: nowrap; 
        }
        .modal-details-grid p i.fas,
        .modal-details-grid p img { 
            margin-right: 8px; 
            color: var(--primary-color); 
            width: 1.2em; 
            text-align: center;
            font-size: 1.05em; 
            flex-shrink: 0; 
        }
        .modal-details-grid p img {
             width: 24px; height: 24px; 
             vertical-align: middle;
        }


        footer {
            background-color: var(--dark-color);
            color: #ccc; 
            padding: var(--padding-xl) 0 var(--padding-md); 
            margin-top: var(--padding-xl);
        }
        .footer-bottom { 
            text-align: center;
            padding-top: var(--padding-md); 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
            font-size: 0.9rem;
        }
        .footer-bottom a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s ease; 
        }
        .footer-bottom a:hover { 
            text-decoration: underline;
            color: var(--primary-color); 
        }

        @media (max-width: 992px) {
            .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
            .hourly-card { min-width: 90px; padding: var(--padding-sm); } 
            .hourly-card .temp { font-size: 1.1rem; }
        }
        @media (max-width: 768px) {
            .header-container { flex-direction: column; height: auto; padding: var(--padding-sm) 0; }
            nav ul { margin-top: var(--padding-sm); justify-content: center; flex-wrap: wrap; }
            nav ul li { margin: 5px 10px; } 
            .hero { padding: 100px 0 60px; margin-top: 100px; } 
            .hero h1 { font-size: 32px; } 
            .hero p.tagline { font-size: 16px; } 
            .section-title h2 { font-size: 1.8rem; }
            .section-subtitle { font-size: 1.3rem; } 
            #currentWeatherCard { grid-template-columns: 1fr; text-align: center; }
            #currentWeatherCard .weather-icon-temp { margin-bottom: var(--padding-md); }
            .current-details-grid p { justify-content: center; } 
            .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); } 
            .search-form-container { max-width: 100%; } 
            .autocomplete-suggestions-container { 
                 top: calc(100% + 10px - var(--padding-md)); 
            }
        }
        @media (max-width: 480px) {
            nav ul li { margin-left: 15px; } 
            nav ul li:last-child { margin-left: 10px; }
            .unit-toggle-btn { padding: 5px 10px; font-size: 0.85rem; min-width: 45px;} 
            .logo { font-size: 22px; } .logo i { font-size: 24px; }
            .hero { padding: 80px 0 40px; margin-top: 90px; } 
            .hero h1 { font-size: 28px; } .hero p.tagline { font-size: 14px; }
            .search-form-wrapper { width: 95%; } 
            .search-form-container { flex-direction: column; border-radius: var(--border-radius-lg); max-width: none; }
            #locationInput { 
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0; 
                text-align: center; 
                padding: 12px 15px; 
                border-right: 1px solid var(--border-color); 
            }
            #searchButton { 
                border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg); 
                padding: 12px 15px; 
                justify-content: center; 
            }
            .autocomplete-suggestions-container { 
                position: static; 
                transform: none;  
                width: 100%;
                max-width: none;
                margin-top: 2px; 
                border-top: 1px solid var(--border-color); 
                box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            }

            .search-input-error { font-size: 0.85rem; }
            .current-details-grid { grid-template-columns: 1fr; } 
            .forecast-grid { grid-template-columns: 1fr; } 
            .hourly-card { min-width: 80px; padding: var(--padding-xs); } 
            .hourly-card .temp { font-size: 1rem;}
            .hourly-card img.condition-icon { width: 35px; height: 35px;}
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo"><i class="fas fa-cloud-sun"></i> WeatherWise</div>
            <nav>
                <ul>
                    <li><a href="#hero-section-target" data-scroll-target="#hero-section-target">Search</a></li>
                    <li><a href="#weather-results-target" data-scroll-target="#weather-results-target">Current Forecast</a></li>
                    <li><button id="unitToggleBtn" class="unit-toggle-btn" title="Switch temperature unit">°C</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero" id="hero-section-target"> 
            <div class="hero-content">
                <h1>Weather Forecast</h1>
                <p class="tagline">Check the 10-day forecast for Yeovil below, or search for any other city.</p>
                <div class="search-form-wrapper">
                    <div class="search-form-container">
                        <input type="text" id="locationInput" placeholder="Enter city name (e.g., London, New York)" autocomplete="off">
                        <button id="searchButton"><i class="fas fa-search"></i> Search</button>
                    </div>
                    <div id="autocompleteSuggestions" class="autocomplete-suggestions-container"></div>
                    <div id="searchInputError" class="search-input-error"></div> 
                    <button id="geolocationBtn" class="geolocation-btn">
                        <i class="fas fa-map-marker-alt"></i><span class="btn-text">Use My Location</span>
                    </button>
                </div>
            </div>
        </section>

        <section class="weather-results-area" id="weather-results-target">
            <div class="container">
                <div id="weatherAlertsContainer" class="weather-alerts-container" style="display: none;"></div>
                <div id="locationHeader" class="section-title"></div>
                <article id="currentWeatherCard"></article>
                <section id="hourlyForecastSection" class="hourly-forecast-section">
                    <h3 class="section-subtitle" id="hourlyForecastTitle">Today's Hourly Forecast</h3>
                    <div id="hourlyForecastContainer" class="hourly-forecast-container">
                        <div class="loader-container hourly-loader-placeholder"><div class="loader"></div></div>
                    </div>
                </section>
                <div class="section-title forecast-section-title">
                    <h2 id="forecastHeader">10-Day Forecast</h2>
                </div>
                <div id="forecastGrid" class="forecast-grid"></div>
            </div>
        </section>
        <div id="statusMessageContainer" class="status-message-container"></div>
    </main>

    <footer>
        <div class="container footer-bottom">
            <p>© <span id="currentYear"></span> WeatherWise. Powered by <a href="https://www.weatherapi.com/" target="_blank" rel="noopener">WeatherAPI.com</a>.</p>
        </div>
    </footer>
    
    <div id="hourlyDetailsModal" class="modal-overlay">
        <div class="modal-content">
            <button id="closeHourlyModalBtn" class="modal-close-btn">×</button>
            <h3 id="modalHourTime" class="modal-title"></h3>
            <div id="modalHourlyDetailsGrid" class="modal-details-grid">
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'a3af77f2f03f42cbbe335101250306'; 
        const DEFAULT_LOCATION = 'Yeovil';
        const FORECAST_DAYS = 10;

        // DOM Elements
        const heroSection = document.querySelector('.hero');
        const locationInput = document.getElementById('locationInput');
        const searchButton = document.getElementById('searchButton');
        const searchInputError = document.getElementById('searchInputError');
        const unitToggleBtn = document.getElementById('unitToggleBtn');
        const geolocationBtn = document.getElementById('geolocationBtn');
        const weatherResultsArea = document.querySelector('.weather-results-area');
        const locationHeaderElement = document.getElementById('locationHeader');
        const currentWeatherCard = document.getElementById('currentWeatherCard');
        const hourlyForecastContainer = document.getElementById('hourlyForecastContainer');
        const forecastGrid = document.getElementById('forecastGrid');
        const statusMessageContainer = document.getElementById('statusMessageContainer');
        const currentYearSpan = document.getElementById('currentYear');
        const autocompleteSuggestionsContainer = document.getElementById('autocompleteSuggestions');
        const hourlyDetailsModal = document.getElementById('hourlyDetailsModal');
        const closeHourlyModalBtn = document.getElementById('closeHourlyModalBtn');
        const modalHourTime = document.getElementById('modalHourTime');
        const modalHourlyDetailsGrid = document.getElementById('modalHourlyDetailsGrid');

        let searchErrorTimeoutId = null;
        let lastSuccessfulWeatherData = null;
        let currentUnit = 'celsius';
        let isFetchingData = false; 
        let debounceTimeout;
        let activeSuggestionIndex = -1;
        let statusMessageTimeoutId = null;
        let scrollDebounceTimeout; // For scroll event debouncing

        // --- INITIALIZATION ---
        function initializeApp() {
            if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();
            loadPreferredUnit();
            addEventListeners();
            fetchWeatherData(DEFAULT_LOCATION, true); 
        }

        function addEventListeners() {
            searchButton.addEventListener('click', () => {
                hideAutocompleteSuggestions();
                handleSearch();
            });
            locationInput.addEventListener('keypress', (e) => { 
                if (e.key === 'Enter') {
                    if (autocompleteSuggestionsContainer.style.display === 'none' || activeSuggestionIndex === -1) {
                         hideAutocompleteSuggestions();
                         handleSearch();
                    }
                } 
            });
            locationInput.addEventListener('input', debounce( () => fetchAutocompleteSuggestions(locationInput.value), 350));
            locationInput.addEventListener('keydown', handleKeydownOnInput);
            
            document.addEventListener('click', function(event) {
                const isClickInsideInput = locationInput.contains(event.target);
                const isClickInsideSuggestions = autocompleteSuggestionsContainer.contains(event.target);
                if (!isClickInsideInput && !isClickInsideSuggestions) {
                    hideAutocompleteSuggestions();
                }
            });

            unitToggleBtn.addEventListener('click', toggleUnit);
            geolocationBtn.addEventListener('click', handleGeolocation);
            
            const mainNav = document.querySelector('header nav');
            if (mainNav) {
                mainNav.addEventListener('click', (event) => {
                    if (event.target.closest('a[data-scroll-target]')) {
                        handleSmoothScroll(event);
                    }
                });
            }

            window.addEventListener('scroll', () => {
                requestAnimationFrame(handleParallax); // Parallax on scroll
                clearTimeout(scrollDebounceTimeout);
                scrollDebounceTimeout = setTimeout(highlightActiveNavLink, 100); 
            });
            window.addEventListener('load', () => {
                highlightActiveNavLink(); 
                handleParallax(); 
            });
            window.addEventListener('resize', () => {
                highlightActiveNavLink(); 
                handleParallax(); 
            });


            if (closeHourlyModalBtn) {
                closeHourlyModalBtn.addEventListener('click', closeHourlyDetailsModal);
            }
            if (hourlyDetailsModal) {
                hourlyDetailsModal.addEventListener('click', (event) => {
                    if (event.target === hourlyDetailsModal) {
                        closeHourlyDetailsModal();
                    }
                });
            }
            window.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && hourlyDetailsModal && hourlyDetailsModal.classList.contains('visible')) {
                    closeHourlyDetailsModal();
                }
            });

            window.addEventListener('online', () => {
                showStatusMessage("You are back online!", 'success', 3000);
                if (!lastSuccessfulWeatherData && locationInput.value) { 
                    handleSearch(); 
                } else if (!lastSuccessfulWeatherData && !locationInput.value) {
                    fetchWeatherData(DEFAULT_LOCATION);
                }
            });
            window.addEventListener('offline', () => {
                showStatusMessage("You are offline. Some features may not be available.", 'error', 5000);
            });
        }
        
        function clearSearchInputError() {
            if (searchInputError.classList.contains('visible')) {
                searchInputError.classList.remove('visible');
                searchInputError.textContent = ''; 
                if (searchErrorTimeoutId) clearTimeout(searchErrorTimeoutId);
            }
        }

        function handleParallax() {
            if (heroSection) {
                const scrollY = window.pageYOffset;
                heroSection.style.backgroundPositionY = `calc(50% + ${scrollY * 0.3}px)`; 
            }
        }
        
        function handleSmoothScroll(event) {
            const link = event.target.closest('a[data-scroll-target]');
            if (link) {
                event.preventDefault();
                const targetId = link.getAttribute('data-scroll-target');
                const targetElement = document.querySelector(targetId);

                if (targetElement) {
                    const headerElement = document.querySelector('header');
                    let headerHeight = headerElement ? headerElement.offsetHeight : 0;
                    
                    if (window.innerWidth <= 768 && headerElement) {
                        const headerContainer = headerElement.querySelector('.header-container');
                        if (headerContainer && getComputedStyle(headerContainer).flexDirection === 'column') {
                             headerHeight = headerContainer.offsetHeight;
                        }
                    }
                    const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight - 20; 
                    window.scrollTo({ top: targetPosition, behavior: 'smooth' });
                }
            }
        }

        function highlightActiveNavLink() {
            const navLinks = document.querySelectorAll('nav ul li a[data-scroll-target]');
            if (navLinks.length === 0) return;

            const headerElement = document.querySelector('header');
            let headerHeight = headerElement ? headerElement.offsetHeight : 0;
             if (window.innerWidth <= 768 && headerElement) { 
                const headerContainer = headerElement.querySelector('.header-container');
                if (headerContainer && getComputedStyle(headerContainer).flexDirection === 'column') {
                     headerHeight = headerContainer.offsetHeight;
                }
            }
            let currentSectionId = '';
            navLinks.forEach(link => {
                const targetId = link.getAttribute('data-scroll-target');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const rect = targetElement.getBoundingClientRect();
                    if (rect.top <= headerHeight + 50 && rect.bottom >= headerHeight + 50) { 
                        if (!currentSectionId) { 
                            currentSectionId = targetId;
                        }
                    }
                }
            });
            
            if (!currentSectionId && window.pageYOffset < (document.querySelector('#hero-section-target')?.offsetHeight || window.innerHeight) * 0.5) {
                 currentSectionId = navLinks[0]?.getAttribute('data-scroll-target');
            }

            navLinks.forEach(link => {
                if (link.getAttribute('data-scroll-target') === currentSectionId) {
                    link.classList.add('active-nav-link');
                } else {
                    link.classList.remove('active-nav-link');
                }
            });
        }


        function loadPreferredUnit() {
            const savedUnit = localStorage.getItem('weatherAppUnit');
            currentUnit = savedUnit === 'fahrenheit' ? 'fahrenheit' : 'celsius';
            updateUnitToggleUI();
        }
        function toggleUnit() {
            currentUnit = currentUnit === 'celsius' ? 'fahrenheit' : 'celsius';
            localStorage.setItem('weatherAppUnit', currentUnit);
            updateUnitToggleUI();
            if (lastSuccessfulWeatherData) displayAllWeatherData(lastSuccessfulWeatherData); 
        }
        function updateUnitToggleUI() {
            unitToggleBtn.textContent = currentUnit === 'celsius' ? '°C' : '°F';
        }
        function getTemp(c, f, unitSymbol = true) {
            const symbol = unitSymbol ? (currentUnit === 'celsius' ? '°C' : '°F') : '';
            if (currentUnit === 'fahrenheit') return f !== undefined ? `${Math.round(f)}${symbol}` : 'N/A';
            return c !== undefined ? `${Math.round(c)}${symbol}` : 'N/A';
        }

        async function handleGeolocation() {
            if (isFetchingData) return;
            if (!navigator.geolocation) {
                showTemporaryError("Geolocation not supported.", 3000); return;
            }
            
            geolocationBtn.disabled = true;
            geolocationBtn.classList.add('geolocation-btn--loading'); 
            hideAutocompleteSuggestions();
            clearSearchInputError();
            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true, 
                        timeout: 15000, 
                        maximumAge: 0 
                    });
                });
                
                console.log('Geolocation Coordinates:', position.coords.latitude, position.coords.longitude);
                locationInput.value = ''; 
                fetchWeatherData(`${position.coords.latitude},${position.coords.longitude}`);
            } catch (error) {
                let msg = "Location error: ";
                switch (error.code) {
                    case error.PERMISSION_DENIED: msg += "Permission denied."; break;
                    case error.POSITION_UNAVAILABLE: msg += "Location unavailable."; break;
                    case error.TIMEOUT: msg += "Request timed out."; break;
                    default: msg += "Unknown error. " + (error.message || ''); break;
                }
                showTemporaryError(msg, 4000);
                console.error("Geolocation Error:", error);
                if (lastSuccessfulWeatherData) {
                    weatherResultsArea.classList.add('visible');
                }
            } finally {
                geolocationBtn.disabled = false;
                geolocationBtn.classList.remove('geolocation-btn--loading'); 
            }
        }
        
        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        async function fetchAutocompleteSuggestions(query) {
            if (query.length < 2) {
                hideAutocompleteSuggestions();
                return;
            }
            const url = `https://api.weatherapi.com/v1/search.json?key=${API_KEY}&q=${encodeURIComponent(query)}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    console.error("Autocomplete API error:", response.status);
                    hideAutocompleteSuggestions();
                    return;
                }
                const suggestions = await response.json();
                if (suggestions.length === 0 && query.length > 1) { 
                    autocompleteSuggestionsContainer.innerHTML = '<li><small>No matching locations found.</small></li>';
                    autocompleteSuggestionsContainer.style.display = 'block';
                    activeSuggestionIndex = -1;
                } else {
                    displayAutocompleteSuggestions(suggestions, query);
                }
            } catch (error) {
                console.error('Fetch Autocomplete Error:', error);
                hideAutocompleteSuggestions();
            }
        }

        function displayAutocompleteSuggestions(suggestions, query) {
            if (!autocompleteSuggestionsContainer) return;
            if (!suggestions || suggestions.length === 0) {
                hideAutocompleteSuggestions();
                return;
            }

            const suggestionsList = document.createElement('ul');
            suggestions.forEach(suggestion => {
                const listItem = document.createElement('li');
                let displayText = suggestion.name;
                if (suggestion.region && suggestion.region !== suggestion.name) displayText += `, ${suggestion.region}`;
                if (suggestion.country && suggestion.country !== suggestion.name && suggestion.country !== suggestion.region) displayText += `, ${suggestion.country}`;
                
                const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                listItem.innerHTML = displayText.replace(regex, '<strong>$1</strong>');
                
                listItem.addEventListener('click', () => {
                    locationInput.value = `${suggestion.name}, ${suggestion.country}`; 
                    fetchWeatherData(locationInput.value);
                    hideAutocompleteSuggestions();
                });
                suggestionsList.appendChild(listItem);
            });

            autocompleteSuggestionsContainer.innerHTML = '';
            autocompleteSuggestionsContainer.appendChild(suggestionsList);
            autocompleteSuggestionsContainer.style.display = 'block';
            activeSuggestionIndex = -1;
        }

        function hideAutocompleteSuggestions() {
            if (autocompleteSuggestionsContainer) {
                autocompleteSuggestionsContainer.innerHTML = '';
                autocompleteSuggestionsContainer.style.display = 'none';
            }
            activeSuggestionIndex = -1;
        }

        function handleKeydownOnInput(e) {
            if (!autocompleteSuggestionsContainer) return;
            const suggestionsItems = autocompleteSuggestionsContainer.querySelectorAll('li');
            if (suggestionsItems.length === 0 || autocompleteSuggestionsContainer.style.display === 'none') {
                 if (e.key === 'Enter') { 
                    hideAutocompleteSuggestions();
                    handleSearch();
                 }
                return;
            }

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                activeSuggestionIndex = (activeSuggestionIndex + 1) % suggestionsItems.length;
                updateActiveSuggestion(suggestionsItems);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                activeSuggestionIndex = (activeSuggestionIndex - 1 + suggestionsItems.length) % suggestionsItems.length;
                updateActiveSuggestion(suggestionsItems);
            } else if (e.key === 'Enter') {
                e.preventDefault(); 
                if (activeSuggestionIndex > -1 && suggestionsItems[activeSuggestionIndex]) {
                    suggestionsItems[activeSuggestionIndex].click(); 
                } else {
                     hideAutocompleteSuggestions(); 
                     handleSearch();
                }
            } else if (e.key === 'Escape') {
                hideAutocompleteSuggestions();
            }
        }

        function updateActiveSuggestion(items) {
            items.forEach(item => item.classList.remove('active-suggestion'));
            if (activeSuggestionIndex > -1 && items[activeSuggestionIndex]) {
                items[activeSuggestionIndex].classList.add('active-suggestion');
                items[activeSuggestionIndex].scrollIntoView({ block: 'nearest' });
            }
        }

        function openHourlyDetailsModal(hourData) {
            if (!hourlyDetailsModal || !modalHourTime || !modalHourlyDetailsGrid) return;

            const hourDate = new Date(hourData.time_epoch * 1000);
            modalHourTime.textContent = `${hourDate.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' })} at ${hourDate.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true })}`;

            modalHourlyDetailsGrid.innerHTML = `
                <p><i class="fas fa-temperature-full"></i> <strong>Temp:</strong> ${getTemp(hourData.temp_c, hourData.temp_f)}</p>
                <p><i class="fas fa-temperature-half"></i> <strong>Feels Like:</strong> ${getTemp(hourData.feelslike_c, hourData.feelslike_f)}</p>
                <p><img src="https:${hourData.condition.icon}" alt="${hourData.condition.text}"> <strong>Condition:</strong> ${hourData.condition.text}</p>
                <p><i class="fas fa-wind"></i> <strong>Wind:</strong> ${Math.round(hourData.wind_kph)} kph (${hourData.wind_dir})</p>
                <p><i class="fas fa-compass"></i> <strong>Wind Gust:</strong> ${Math.round(hourData.gust_kph)} kph</p>
                <p><i class="fas fa-tint"></i> <strong>Humidity:</strong> ${hourData.humidity}%</p>
                <p><i class="fas fa-cloud-rain"></i> <strong>Rain Chance:</strong> ${hourData.chance_of_rain}%</p>
                <p><i class="fas fa-snowflake"></i> <strong>Snow Chance:</strong> ${hourData.chance_of_snow}%</p>
                <p><i class="fas fa-eye"></i> <strong>Visibility:</strong> ${hourData.vis_km} km</p>
                <p><i class="fas fa-gauge-high"></i> <strong>Pressure:</strong> ${hourData.pressure_mb} mb</p>
                <p><i class="fas fa-sun"></i> <strong>UV Index:</strong> ${hourData.uv}</p>
            `;

            hourlyDetailsModal.classList.add('visible');
        }

        function closeHourlyDetailsModal() {
            if (hourlyDetailsModal) {
                hourlyDetailsModal.classList.remove('visible');
            }
        }

        function showTemporaryError(message, duration = 3000) { 
            searchInputError.textContent = message;
            searchInputError.classList.add('visible');
            if (searchErrorTimeoutId) clearTimeout(searchErrorTimeoutId);
            searchErrorTimeoutId = setTimeout(() => {
                searchInputError.classList.remove('visible');
                 setTimeout(() => { searchInputError.textContent = ''; }, 300); 
            }, duration);
        }

        function showStatusMessage(message, type = 'info', duration = 4000) {
            if (!statusMessageContainer) return;
            if (statusMessageTimeoutId) clearTimeout(statusMessageTimeoutId);

            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            
            if (type === 'error') messageDiv.className = 'error-message';
            else if (type === 'success') messageDiv.className = 'success-message';
            else if (type === 'info') messageDiv.className = 'info-message';
            else messageDiv.className = 'status-message';

            statusMessageContainer.innerHTML = ''; 
            statusMessageContainer.appendChild(messageDiv);
            statusMessageContainer.classList.add('visible'); 

            if (duration > 0) {
                statusMessageTimeoutId = setTimeout(() => {
                    statusMessageContainer.classList.remove('visible');
                    setTimeout(() => { 
                        if (statusMessageContainer.contains(messageDiv)) { 
                           statusMessageContainer.innerHTML = '';
                        }
                    }, 300); 
                }, duration);
            }
        }

        function showGeneralError(message) { 
            showStatusMessage(message, 'error', 0); 
            if(currentWeatherCard) currentWeatherCard.innerHTML = ''; 
            if(hourlyForecastContainer) hourlyForecastContainer.innerHTML = '';
            if(forecastGrid) forecastGrid.innerHTML = '';
            if(locationHeaderElement) locationHeaderElement.innerHTML = '';
            if(weatherResultsArea) weatherResultsArea.classList.remove('visible');
            lastSuccessfulWeatherData = null; 
        }

        function clearGeneralError() {
            if (statusMessageContainer) {
                statusMessageContainer.classList.remove('visible');
                statusMessageContainer.innerHTML = '';
            }
            if (statusMessageTimeoutId) clearTimeout(statusMessageTimeoutId);
        }

        function showLoaders() {
            if (!lastSuccessfulWeatherData || !weatherResultsArea.classList.contains('visible')) {
                weatherResultsArea.classList.remove('visible');
                if(locationHeaderElement) locationHeaderElement.innerHTML = '';

                if(currentWeatherCard) currentWeatherCard.innerHTML = `
                    <div class="skeleton-current-weather">
                        <div><div class="skeleton-icon-main"></div></div>
                        <div class="skeleton-details-main">
                            <div class="skeleton-line-large"></div>
                            <div class="skeleton-line-medium" style="width: 70%;"></div>
                        </div>
                        <div class="skeleton-grid" style="grid-column: 1 / -1;">
                            <div class="skeleton-line-small"></div> <div class="skeleton-line-small"></div>
                            <div class="skeleton-line-small"></div> <div class="skeleton-line-small"></div>
                            <div class="skeleton-line-small"></div> <div class="skeleton-line-small"></div>
                        </div>
                    </div>`;

                if(hourlyForecastContainer) {
                    let hourlySkeletonsHTML = '<div class="skeleton-hourly-card-container">';
                    for (let i = 0; i < 5; i++) {
                        hourlySkeletonsHTML += `
                            <div class="skeleton-hourly-card">
                                <div class="skeleton-line-xsmall" style="width: 60%;"></div>
                                <div class="skeleton-icon-small"></div>
                                <div class="skeleton-line-small" style="width: 70%;"></div>
                                <div class="skeleton-line-xsmall" style="width: 50%;"></div>
                            </div>`;
                    }
                    hourlySkeletonsHTML += '</div>';
                    hourlyForecastContainer.innerHTML = hourlySkeletonsHTML;
                }

                if(forecastGrid){
                    let dailySkeletonsHTML = '<div class="skeleton-forecast-grid">';
                    const numDailySkeletons = window.innerWidth < 768 ? 3 : 5;
                    for (let i = 0; i < numDailySkeletons; i++) { 
                        dailySkeletonsHTML += `
                            <div class="skeleton-forecast-card">
                                <div class="skeleton-line-small" style="width: 50%;"></div>
                                <div class="skeleton-icon-medium"></div>
                                <div class="skeleton-line-medium" style="width: 70%;"></div>
                                <div class="skeleton-line-small" style="width: 90%;"></div>
                                <div class="skeleton-line-xsmall" style="width: 60%;"></div>
                            </div>`;
                    }
                    dailySkeletonsHTML += '</div>';
                    forecastGrid.innerHTML = dailySkeletonsHTML;
                }
                
                document.querySelectorAll('.loader-container').forEach(lc => lc.classList.add('hidden-by-skeleton'));
            }
        }

        function handleSearch() { 
            if (isFetchingData) return;
            const query = locationInput.value.trim();
            if (!query) {
                showTemporaryError("Please enter a city name."); return;
            }
            clearSearchInputError();
            hideAutocompleteSuggestions(); 
            fetchWeatherData(query);
        }

        async function fetchWeatherData(locationQuery, isInitialLoad = false) {
            if (isFetchingData && !isInitialLoad) return; 
            isFetchingData = true;
            
            if (!navigator.onLine) {
                showStatusMessage("You are offline. Cannot fetch weather data.", 'error', 5000);
                if (isInitialLoad || !lastSuccessfulWeatherData) {
                    showGeneralError("You are offline. Please check your internet connection.");
                }
                isFetchingData = false;
                return;
            }

            if (isInitialLoad || !lastSuccessfulWeatherData) { 
                showLoaders();
            }
            clearGeneralError(); 

            const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${encodeURIComponent(locationQuery)}&days=${FORECAST_DAYS}&aqi=yes&alerts=yes`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    let errorMsg = `Error: ${response.status} ${response.statusText}`;
                    let isCritical = false; 

                    if (response.status === 400) {
                        const errorData = await response.json().catch(() => null);
                        errorMsg = (errorData && errorData.error && errorData.error.message) 
                                   ? errorData.error.message 
                                   : "Invalid location or API request. Please check the city name.";
                        showTemporaryError(errorMsg, 4000); 
                    } else if (response.status === 401 || response.status === 403) {
                        errorMsg = "API key error or access denied. Please contact support.";
                        isCritical = true;
                    } else if (response.status === 429) { 
                        errorMsg = "Too many requests. Please try again in a few minutes.";
                        showStatusMessage(errorMsg, 'error', 5000);
                    } else if (response.status >= 500) { 
                        errorMsg = "Weather service is temporarily unavailable. Please try again later.";
                        showStatusMessage(errorMsg, 'error', 5000);
                    } else { 
                        const errorData = await response.json().catch(() => null);
                        errorMsg = (errorData && errorData.error && errorData.error.message) 
                                   ? errorData.error.message
                                   : `Could not fetch weather data (${response.status})`;
                        showTemporaryError(errorMsg, 4000);
                    }
                    
                    const fetchError = new Error(errorMsg);
                    fetchError.isCritical = isCritical; 
                    fetchError.responseStatus = response.status;
                    throw fetchError;
                }
                const data = await response.json();
                
                lastSuccessfulWeatherData = data; 
                displayAllWeatherData(data);      
                
                if (!isInitialLoad) { 
                    if(document.getElementById('weather-results-target')) {
                       document.getElementById('weather-results-target').scrollIntoView({ behavior: 'smooth' });
                    }
                }

            } catch (error) {
                console.error('Fetch Weather Error:', error.message, error);
                
                if (error.isCritical || (isInitialLoad && !lastSuccessfulWeatherData)) {
                    showGeneralError(`Failed to load weather: ${error.message}`);
                } else if (!lastSuccessfulWeatherData && error.responseStatus === 400) {
                    showGeneralError(`Could not find weather for "${locationQuery}". Please check the name.`);
                } else if (lastSuccessfulWeatherData) {
                    if(weatherResultsArea) weatherResultsArea.classList.add('visible');
                    displayAllWeatherData(lastSuccessfulWeatherData); // Re-display last good data
                    if (error.responseStatus !== 429 && error.responseStatus < 500 && error.responseStatus !== 400 ) { 
                        showTemporaryError(error.message || "Could not update weather data.", 4000);
                    }
                } else {
                     showGeneralError(`Could not fetch weather data. ${error.message}`);
                }
            } finally {
                isFetchingData = false;
            }
        }

        function displayWeatherAlerts(alertsData) {
            const alertsContainer = document.getElementById('weatherAlertsContainer');
            if (!alertsContainer) return;

            alertsContainer.innerHTML = ''; 
            alertsContainer.style.display = 'none'; 

            if (alertsData && alertsData.alert && alertsData.alert.length > 0) {
                const alertsList = document.createElement('ul');
                alertsList.className = 'alerts-list';

                alertsData.alert.forEach(alertItem => {
                    const listItem = document.createElement('li');
                    listItem.className = 'alert-item';
                    if (alertItem.severity) {
                        listItem.classList.add(`alert-severity-${alertItem.severity.toLowerCase().replace(/\s+/g, '-')}`);
                    }

                    listItem.innerHTML = `
                        <h4 class="alert-headline"><i class="fas fa-triangle-exclamation"></i> ${alertItem.headline}</h4>
                        <p class="alert-event"><strong>Event:</strong> ${alertItem.event || 'N/A'}</p>
                        <p class="alert-description">${alertItem.desc || 'No further details.'}</p>
                        <p class="alert-instruction"><em>${alertItem.instruction || ''}</em></p>
                        ${alertItem.areas ? `<p class="alert-areas"><strong>Affected Areas:</strong> ${alertItem.areas}</p>` : ''}
                    `;
                    alertsList.appendChild(listItem);
                });

                alertsContainer.appendChild(alertsList);
                alertsContainer.style.display = 'block'; 
            }
        }

        function displayAllWeatherData(data) {
            clearGeneralError(); 
            if(currentWeatherCard) currentWeatherCard.classList.remove('content-visible'); 
            
            displayWeatherAlerts(data.alerts); 
            const todayAstroData = data.forecast && data.forecast.forecastday && data.forecast.forecastday.length > 0 ? data.forecast.forecastday[0].astro : null;
            displayCurrentWeather(data.location, data.current, todayAstroData); 

            if (data.forecast && data.forecast.forecastday && data.forecast.forecastday.length > 0 && data.forecast.forecastday[0].hour) {
                displayHourlyForecast(data.forecast.forecastday[0].hour);
            } else {
                if(hourlyForecastContainer) hourlyForecastContainer.innerHTML = '<p style="padding: 10px; text-align:center; width:100%;">Hourly forecast data not available.</p>';
            }
            
            if (data.forecast && data.forecast.forecastday) {
                displayDailyForecast(data.forecast.forecastday);
            } else {
                 if(forecastGrid) forecastGrid.innerHTML = '<p style="padding: 10px; text-align:center; width:100%; grid-column: 1 / -1;">Daily forecast data not available.</p>';
            }
            if(weatherResultsArea) weatherResultsArea.classList.add('visible'); 
        }

        function displayCurrentWeather(location, current, astroData) {
            if(!locationHeaderElement || !currentWeatherCard) return;

            locationHeaderElement.innerHTML = `<h2>${location.name}, ${location.country}</h2>`;
            
            const feelsLikeTempC = current.feelslike_c;
            const feelsLikeTempF = current.feelslike_f;

            let aqiValueDisplay = 'N/A'; 
            let aqiClass = 'aqi-na';    
            if (current.air_quality && current.air_quality['us-epa-index']) {
                const epaIndex = current.air_quality['us-epa-index'];
                let aqiText = '';
                switch (epaIndex) {
                    case 1: aqiText = ' (Good)'; aqiClass = 'aqi-good'; break;
                    case 2: aqiText = ' (Moderate)'; aqiClass = 'aqi-moderate'; break;
                    case 3: aqiText = ' (Unhealthy for sensitive groups)'; aqiClass = 'aqi-unhealthy-sensitive'; break;
                    case 4: aqiText = ' (Unhealthy)'; aqiClass = 'aqi-unhealthy'; break;
                    case 5: aqiText = ' (Very Unhealthy)'; aqiClass = 'aqi-very-unhealthy'; break;
                    case 6: aqiText = ' (Hazardous)'; aqiClass = 'aqi-hazardous'; break;
                    default: aqiText = ''; aqiClass = 'aqi-na';
                }
                aqiValueDisplay = `${epaIndex}${aqiText}`;
            }

            let sunriseTime = 'N/A';
            let sunsetTime = 'N/A';
            if (astroData) {
                sunriseTime = astroData.sunrise ? astroData.sunrise.trim() : 'N/A';
                sunsetTime = astroData.sunset ? astroData.sunset.trim() : 'N/A';
            }
            
            const heroSectionElement = document.querySelector('.hero'); 
            if (heroSectionElement) {
                let backgroundImage = `url('https://images.unsplash.com/photo-1500340520802-1687637c03a4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`; 
                const conditionText = current.condition.text.toLowerCase();
                const isDay = current.is_day === 1;

                if (!isDay) { 
                    if (conditionText.includes('clear') || conditionText.includes('sunny')) { 
                        backgroundImage = `url('https://images.unsplash.com/photo-1472552944129-b035e9ea3744?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('cloudy') || conditionText.includes('overcast') || conditionText.includes('partly cloudy')) {
                         backgroundImage = `url('https://images.unsplash.com/photo-1502404642721-6c0009003757?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('rain') || conditionText.includes('drizzle') || conditionText.includes('shower')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1518803194020-5948167f754d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('snow') || conditionText.includes('sleet') || conditionText.includes('blizzard')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1483018835330-9e2a05804947?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('mist') || conditionText.includes('fog')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1480497490787-505ec076689f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    }
                } else { 
                    if (conditionText.includes('sunny') || conditionText.includes('clear')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1601297183305-9df1427fe523?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('partly cloudy')) {
                         backgroundImage = `url('https://images.unsplash.com/photo-1566995290510-5c0a4568eed5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('cloudy') || conditionText.includes('overcast')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1501630834273-4b5604d2eb39?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('rain') || conditionText.includes('drizzle') || conditionText.includes('shower')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('snow') || conditionText.includes('sleet') || conditionText.includes('blizzard')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1517299321609-524b03535a49?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('mist') || conditionText.includes('fog')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1431958283943-f6578b2c45e5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    } else if (conditionText.includes('thunder')) {
                        backgroundImage = `url('https://images.unsplash.com/photo-1605727216801-e27ce1d0cc28?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80')`;
                    }
                }
                if (heroSectionElement.style.backgroundImage !== backgroundImage) { 
                    heroSectionElement.style.backgroundImage = backgroundImage;
                }
            }

            currentWeatherCard.innerHTML = `
                <div class="weather-icon-temp">
                    <img src="https:${current.condition.icon}" alt="${current.condition.text}" class="current-icon">
                    <p class="current-temperature">${getTemp(current.temp_c, current.temp_f)}</p>
                    <p class="current-condition">${current.condition.text}</p>
                </div>
                <div class="current-details-grid">
                    <p><i class="fas fa-temperature-half" title="Feels Like"></i> <strong>Feels Like:</strong> ${getTemp(feelsLikeTempC, feelsLikeTempF)}</p>
                    <p><i class="fas fa-tint" title="Humidity" style="color: #3498db;"></i> <strong>Humidity:</strong> ${current.humidity}%</p>
                    <p><i class="fas fa-wind" title="Wind" style="color: #95a5a6;"></i> <strong>Wind:</strong> ${Math.round(current.wind_kph)} kph / ${Math.round(current.wind_mph)} mph ${current.wind_dir}</p>
                    <p><i class="fas fa-gauge-high" title="Pressure" style="color: #16a085;"></i> <strong>Pressure:</strong> ${current.pressure_mb} mb</p>
                    <p><i class="fas fa-eye" title="Visibility" style="color: #2980b9;"></i> <strong>Visibility:</strong> ${current.vis_km} km / ${current.vis_miles} miles</p>
                    <p><i class="fas fa-sun" title="UV Index" style="color: #f39c12;"></i> <strong>UV Index:</strong> ${current.uv}</p>
                    <p><i class="fas fa-cloud" title="Cloud Cover" style="color: #bdc3c7;"></i> <strong>Cloud Cover:</strong> ${current.cloud}%</p>
                    <p><i class="fas fa-smog" title="Air Quality Index"></i> <strong>AQI (US EPA):</strong> <span class="${aqiClass}">${aqiValueDisplay}</span></p>
                    <p><i class="fas fa-sunrise" title="Sunrise"></i> <strong>Sunrise:</strong> ${sunriseTime}</p>
                    <p><i class="fas fa-sunset" title="Sunset"></i> <strong>Sunset:</strong> ${sunsetTime}</p>
                    <p><i class="fas fa-clock" title="Last Updated" style="color: #7f8c8d;"></i> <strong>Last Updated:</strong> ${new Date(current.last_updated_epoch * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                </div>
            `;
            requestAnimationFrame(() => {
                if(currentWeatherCard) currentWeatherCard.classList.add('content-visible');
            });
        }

        function displayHourlyForecast(hourlyDataFullDay) {
            if(!hourlyForecastContainer) return;
            hourlyForecastContainer.innerHTML = ''; 
            if (!hourlyDataFullDay || hourlyDataFullDay.length === 0) {
                hourlyForecastContainer.innerHTML = `<p style="padding: 10px; text-align:center; width:100%;">Hourly forecast data not available.</p>`;
                return;
            }

            hourlyDataFullDay.forEach((hour, index) => {
                const hourDate = new Date(hour.time_epoch * 1000);
                const card = document.createElement('div');
                card.className = 'hourly-card'; 
                card.innerHTML = `
                    <p class="time">${hourDate.toLocaleTimeString([], { hour: 'numeric', hour12: true })}</p>
                    <img src="https:${hour.condition.icon}" alt="${hour.condition.text}" class="condition-icon">
                    <p class="temp">${getTemp(hour.temp_c, hour.temp_f)}</p>
                    <p class="chance-of-rain"><i class="fas fa-tint" style="color: #3498db;"></i> ${hour.chance_of_rain}%</p>
                `;
                card.addEventListener('click', () => openHourlyDetailsModal(hour));
                hourlyForecastContainer.appendChild(card);
                setTimeout(() => card.classList.add('visible'), index * 60); 
            });
        }

        function displayDailyForecast(forecastDays) {
            if(!forecastGrid) return;
            forecastGrid.innerHTML = ''; 
            if (!forecastDays || forecastDays.length === 0) {
                 forecastGrid.innerHTML = `<p style="padding: 10px; text-align:center; width:100%; grid-column: 1 / -1;">Daily forecast data not available.</p>`;
                 return;
            }
            forecastDays.forEach((dayData, index) => {
                const day = dayData.day;
                const card = document.createElement('div');
                card.className = 'forecast-card'; 
                const date = new Date(dayData.date_epoch * 1000);
                const dayName = index === 0 ? "Today" : date.toLocaleDateString([], { weekday: 'short' });
                
                card.innerHTML = `
                    <p class="date">${dayName} <span style="font-weight:normal; font-size:0.8em">(${date.toLocaleDateString([], {month:'short', day:'numeric'})})</span></p>
                    <img src="https:${day.condition.icon}" alt="${day.condition.text}" class="forecast-icon">
                    <p class="temperature">${getTemp(day.avgtemp_c, day.avgtemp_f)}</p>
                    <p class="condition">${day.condition.text}</p>
                    <p class="min-max">
                        <i class="fas fa-temperature-arrow-up" title="Max Temperature" style="color: #e74c3c;"></i> ${getTemp(day.maxtemp_c, day.maxtemp_f, false)} / 
                        <i class="fas fa-temperature-arrow-down" title="Min Temperature" style="color: #3498db;"></i> ${getTemp(day.mintemp_c, day.mintemp_f, false)}
                    </p>
                    <p class="chance-of-rain" style="font-size: 0.75rem; margin-top: 4px;"><i class="fas fa-tint" style="color: #3498db;"></i> Rain: ${day.daily_chance_of_rain}%</p>
                `;
                forecastGrid.appendChild(card);
                setTimeout(() => card.classList.add('visible'), index * 100); 
            });
        }
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>