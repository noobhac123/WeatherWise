<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWise - Live Yeovil Forecast & More</title>
    <meta name="description" content="Live, real-time Yeovil weather: current conditions, hourly, and daily forecasts. Search any city with WeatherWise.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-family: 'Inter', sans-serif;
            --text-global-primary: #EAEAEA;
            --text-global-secondary: #B0B0B0;
            --page-bg-start: #1F2937;
            --page-bg-end: #111827;
            --card-bg: rgba(255, 255, 255, 0.07);
            --hero-details-card-bg: rgba(0, 0, 0, 0.15);
            --card-border: rgba(255, 255, 255, 0.12);
            --accent-primary: #38BDF8; /* Light Blue for logo & accents */
            --accent-secondary: #FACC15; /* Yellow for logo sun */
            --error-color: #F87171;
            --border-radius: 12px;
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 8px 25px rgba(0, 0, 0, 0.25);
        }

        .svg-icon-defs { display: none; }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            color: var(--text-global-primary);
            background-color: var(--page-bg-end);
            background-image: linear-gradient(160deg, var(--page-bg-start), var(--page-bg-end));
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        button, input[type="button"], input[type="submit"], .logo-area, .icon-button {
            outline: none !important;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            box-shadow: none !important;
        }
        .search-container .icon-button:focus, .search-container .icon-button:active,
        .logo-area:focus, .logo-area:active {
            background-color: transparent !important;
        }

        .site-header {
            padding: 20px 0;
            background: rgba(17, 24, 39, 0.3);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo-area { display: flex; align-items: center; text-decoration: none; }
        .logo-area .logo-icon {
            width: 40px; height: 40px;
            margin-right: 10px;
        }
        .logo-area .site-title { font-size: 1.6em; font-weight: 700; color: var(--text-global-primary); }

        .search-container { display: flex; align-items: center; gap: 10px; }
        .search-container input[type="text"] {
            padding: 10px 15px; border-radius: var(--border-radius);
            border: 1px solid var(--card-border); background: var(--card-bg);
            color: var(--text-global-primary); font-size: 0.95em; min-width: 200px;
            transition: border-color 0.3s;
        }
        .search-container input[type="text"]::placeholder { color: var(--text-global-secondary); }
        .search-container input[type="text"]:focus { outline: none; border-color: var(--accent-primary); }
        .search-container .icon-button { background: none; border: none; cursor: pointer; padding: 8px; display: flex; }
        .search-container .icon-button svg { width: 22px; height: 22px; fill: var(--text-global-secondary); transition: fill 0.3s; }
        .search-container .icon-button:hover svg { fill: var(--accent-primary); }

        .current-weather-section {
            padding: 50px 0 70px; text-align: center;
            color: var(--text-global-primary); min-height: auto; position: relative;
        }
         .current-weather-section::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.03); z-index: 0; opacity: 1;
        }
        .current-weather-section > .container { position: relative; z-index: 1; }

        .location-time .location { font-size: 2.4em; font-weight: 700; margin-bottom: 5px; text-shadow: 1px 1px 5px rgba(0,0,0,0.25); color: var(--text-global-primary); }
        .location-time .time { font-size: 1em; margin-bottom: 35px; color: var(--text-global-secondary); }
        .weather-primary { display: flex; flex-direction: column; align-items: center; margin-bottom: 35px; }
        .weather-primary .main-icon svg { width: 110px; height: 110px; margin-bottom: 10px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2)); }
        .weather-primary .temperature { font-size: 5em; font-weight: 200; line-height: 1; color: var(--text-global-primary); }
        .weather-primary .condition { font-size: 1.5em; font-weight: 400; margin-top: 10px; color: var(--text-global-secondary); }
        .weather-details-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 18px; max-width: 750px; width: 100%; padding: 25px;
            background: var(--hero-details-card-bg);
            border: 1px solid rgba(255,255,255,0.05); border-radius: var(--border-radius);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        }
        .detail-box .label { font-size: 0.85em; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-global-secondary); }
        .detail-box .value { font-size: 1.2em; font-weight: 500; color: var(--text-global-primary); }

        .forecast-section { padding: 50px 0; color: var(--text-global-primary); }
        .section-title {
            font-size: 2em; font-weight: 600; color: var(--text-global-primary);
            margin-bottom: 35px; text-align: center;
            border-bottom: 3px solid var(--accent-primary); display: inline-block; padding-bottom: 8px;
            position: relative; left: 50%; transform: translateX(-50%);
        }
        .hourly-forecast-scroller {
            overflow-x: auto; padding-bottom: 20px; -webkit-overflow-scrolling: touch;
            display: flex; justify-content: flex-start;
        }
        .hourly-forecast-list { display: flex; gap: 18px; margin: 0 auto; }
        @media (min-width: 769px) {
            .hourly-forecast-scroller { justify-content: center; }
        }

        .hour-card {
            flex: 0 0 110px; padding: 20px 15px; text-align: center;
            background: var(--card-bg); border: 1px solid var(--card-border);
            border-radius: var(--border-radius); transition: transform 0.2s, box-shadow 0.2s;
        }
        .hour-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-light); }
        .hour-card .time { font-size: 0.9em; color: var(--text-global-secondary); margin-bottom: 12px; }
        .hour-card .icon svg { width: 40px; height: 40px; margin-bottom: 10px; }
        .hour-card .temp { font-size: 1.3em; font-weight: 500; margin-bottom: 6px; color: var(--text-global-primary); }
        .hour-card .pop { font-size: 0.85em; color: var(--accent-primary); }

        .daily-forecast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 18px; }
        .day-card {
            padding: 20px; background: var(--card-bg); border: 1px solid var(--card-border);
            border-radius: var(--border-radius); text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .day-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-light); }
        .day-card .day-name { font-size: 1.15em; font-weight: 500; margin-bottom: 5px; color: var(--text-global-primary); }
        .day-card .date { font-size: 0.85em; color: var(--text-global-secondary); margin-bottom: 12px; }
        .day-card .icon svg { width: 50px; height: 50px; margin-bottom: 12px; }
        .day-card .temps { font-size: 1.15em; margin-bottom: 8px; color: var(--text-global-primary); }
        .day-card .temps .high { font-weight: 500; }
        .day-card .temps .low { color: var(--text-global-secondary); margin-left: 5px; }
        .day-card .condition-daily { font-size: 0.9em; color: var(--text-global-secondary); }

        .loading-overlay, .error-message { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); z-index: 2000; text-align: center; }
        .loading-overlay p, .error-message p { color: var(--text-global-primary); font-size: 1.2em; padding: 20px; background: var(--page-bg-start); border-radius: var(--border-radius); box-shadow: var(--shadow-strong); }
        .error-message p { background: var(--error-color); color: white; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 4px solid var(--accent-primary); width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .site-footer { text-align: center; padding: 30px 15px; margin-top: 40px; font-size: 0.85em; color: var(--text-global-secondary); border-top: 1px solid var(--card-border); }
        .site-footer a { color: var(--accent-primary); text-decoration: none; }
        .site-footer a:hover { text-decoration: underline; }

        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            .search-container input[type="text"] { min-width: auto; width: 100%; }
            .current-weather-section { padding: 30px 0 40px; }
            .location-time .location { font-size: 2em; }
            .weather-primary .main-icon svg { width: 90px; height: 90px; }
            .weather-primary .temperature { font-size: 4em; }
            .weather-primary .condition { font-size: 1.3em; }
            .weather-details-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; }
            .section-title { font-size: 1.6em; }
            .daily-forecast-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
            .hourly-forecast-scroller { justify-content: flex-start; }
        }
        @media (max-width: 480px) {
            .logo-area .logo-icon { width: 36px; height: 36px; }
            .logo-area .site-title { font-size: 1.5em;}
            .location-time .location { font-size: 1.7em; }
            .weather-primary .main-icon svg { width: 80px; height: 80px; }
            .weather-primary .temperature { font-size: 3.5em; }
            .weather-primary .condition { font-size: 1.2em; }
            .weather-details-grid { grid-template-columns: 1fr; }
            .hourly-forecast-list { gap: 12px; }
            .hour-card { flex: 0 0 100px; }
        }
    </style>
</head>
<body>

    <svg class="svg-icon-defs">
        <defs>
            <symbol id="logo-weatherwise-professional" viewBox="0 0 100 100">
                <path d="M77.5,36.3c-0.6-15.1-12.5-27.2-27.8-27.5C34.9,8.4,22.8,19.8,22,34.5c-0.5-0.1-1-0.2-1.5-0.2 C10.9,34.3,3,42.4,3,51.8c0,9.6,7.7,17.4,17.2,17.4h42.7c8.9,0,16.1-7.2,16.1-16.1C79,45.2,79,40.4,77.5,36.3z" fill="var(--accent-primary)"/>
                <circle cx="37.5" cy="30.5" r="15" fill="var(--accent-secondary)"/>
                <path d="M74.1,38.2c-0.5-2.5-1.4-4.8-2.7-6.8c-0.6-1-1.4-1.9-2.2-2.7c-0.3,0-0.5,0-0.8,0c-2,0-3.8,0.5-5.5,1.3 c-2.5-7.2-9.1-12.4-16.9-12.4c-9.6,0-17.8,5.7-21.9,13.9c-1.3-0.3-2.6-0.5-4.1-0.5c-8,0-14.5,6.6-14.5,14.5s6.5,14.5,14.5,14.5 h37.8c6.2,0,11.2-5,11.2-11.2C79,44.3,77,40.8,74.1,38.2z" fill="white" opacity="0.15"/>
            </symbol>
            <!-- Other weather icons -->
            <symbol id="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" fill="currentColor"/><line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
            <symbol id="icon-cloud" viewBox="0 0 24 24"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" fill="currentColor"/></symbol>
            <symbol id="icon-cloud-sun" viewBox="0 0 24 24"><path d="M12 2.5A5.5 5.5 0 0 0 6.5 8H6a4 4 0 0 0-4 4 4 4 0 0 0 4 4h10a4 4 0 0 0 4-4 4 4 0 0 0-4-4h-.5A5.5 5.5 0 0 0 12 2.5zM12 4a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7z" fill="currentColor" opacity="0.5"/><path d="M18 15H6a2 2 0 0 0-2 2v0a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v0a2 2 0 0 0-2-2z" fill="currentColor"/><circle cx="12" cy="7.5" r="3.5" fill="#FFD700"/></symbol>
            <symbol id="icon-rain" viewBox="0 0 24 24"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" fill="currentColor" opacity="0.6"/><line x1="12" y1="14" x2="12" y2="18" stroke="#4FC3F7" stroke-width="2" stroke-linecap="round" /><line x1="9" y1="15" x2="9" y2="19" stroke="#4FC3F7" stroke-width="2" stroke-linecap="round" /><line x1="15" y1="15" x2="15" y2="19" stroke="#4FC3F7" stroke-width="2" stroke-linecap="round" /></symbol>
            <symbol id="icon-showers" viewBox="0 0 24 24"><use xlink:href="#icon-cloud-sun" opacity="0.7"/><line x1="10" y1="15" x2="10" y2="19" stroke="#81D4FA" stroke-width="1.5" stroke-linecap="round" /><line x1="14" y1="16" x2="14" y2="20" stroke="#81D4FA" stroke-width="1.5" stroke-linecap="round" /></symbol>
            <symbol id="icon-thunderstorm" viewBox="0 0 24 24"><use xlink:href="#icon-cloud" fill="#546E7A"/><polygon points="11 13 13 13 12 17 14 15 10 15 11 11" fill="#FFEB3B"/><line x1="8" y1="16" x2="8" y2="20" stroke="#4FC3F7" stroke-width="1.5" stroke-linecap="round" /><line x1="16" y1="16" x2="16" y2="20" stroke="#4FC3F7" stroke-width="1.5" stroke-linecap="round" /></symbol>
            <symbol id="icon-snow" viewBox="0 0 24 24"><use xlink:href="#icon-cloud" fill="#B0BEC5"/><circle cx="10" cy="15" r="1" fill="white"/> <circle cx="14" cy="15" r="1" fill="white"/><circle cx="12" cy="17" r="1" fill="white"/> <circle cx="9" cy="18" r="1" fill="white"/><circle cx="15" cy="18" r="1" fill="white"/> <circle cx="12" cy="19" r="1" fill="white"/></symbol>
            <symbol id="icon-search" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z" clip-rule="evenodd" /></symbol>
            <symbol id="icon-location" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></symbol>
            <symbol id="icon-default" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" fill="currentColor"/></symbol>
        </defs>
    </svg>

    <header class="site-header">
        <div class="container header-content">
            <a href="#" onclick="window.location.reload()" class="logo-area">
                <svg class="logo-icon"><use xlink:href="#logo-weatherwise-professional"></use></svg>
                <span class="site-title">WeatherWise</span>
            </a>
            <div class="search-container">
                <input type="text" id="location-search-input" placeholder="Search city or postcode...">
                <button class="icon-button" id="search-button" aria-label="Search location">
                    <svg><use xlink:href="#icon-search"></use></svg>
                </button>
                <button class="icon-button" id="geolocation-button" aria-label="Use current location">
                    <svg><use xlink:href="#icon-location"></use></svg>
                </button>
            </div>
        </div>
    </header>

    <main>
        <section id="current-weather-section" class="current-weather-section">
            <div class="container">
                <div class="location-time">
                    <h1 id="location-name-display" class="location">Loading Location...</h1>
                    <p id="current-datetime-display" class="time">Fetching date & time...</p>
                </div>
                <div class="weather-primary">
                    <div id="main-weather-icon-display" class="main-icon"></div>
                    <div id="current-temperature-display" class="temperature">--°C</div>
                    <p id="current-condition-display" class="condition">Loading condition...</p>
                </div>
                <div class="weather-details-grid">
                    <div class="detail-box"><span class="label">Feels Like</span><span id="feels-like-display" class="value">--°C</span></div>
                    <div class="detail-box"><span class="label">Wind</span><span id="wind-display" class="value">-- ---</span></div>
                    <div class="detail-box"><span class="label">Humidity</span><span id="humidity-display" class="value">--%</span></div>
                    <div class="detail-box"><span class="label">Rain</span><span id="rain-today-display" class="value">--%</span></div>
                    <div class="detail-box"><span class="label">Pressure</span><span id="pressure-display" class="value">----mb</span></div>
                    <div class="detail-box"><span class="label">UV Index</span><span id="uv-index-display" class="value">--</span></div>
                </div>
            </div>
        </section>

        <section class="forecast-section">
            <div class="container">
                <h2 class="section-title">Hourly Forecast</h2>
                <div class="hourly-forecast-scroller">
                    <div id="hourly-forecast-list-display" class="hourly-forecast-list">
                        <p style="padding:10px;">Loading hourly forecast...</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="forecast-section">
            <div class="container">
                <h2 class="section-title">Daily Forecast</h2>
                <div id="daily-forecast-grid-display" class="daily-forecast-grid">
                     <p style="padding:10px; grid-column: 1 / -1;">Loading daily forecast... (Note: Free API tier may limit to 3 days)</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <p>© <span id="current-year"></span> WeatherWise. All rights reserved.</p>
        <p>Weather data powered by <a href="https://www.weatherapi.com/" title="Free Weather API" target="_blank" rel="noopener">WeatherAPI.com</a>.</p>
    </footer>

    <div id="loading-overlay" class="loading-overlay"><div><div class="spinner"></div><p>Fetching weather data...</p></div></div>
    <div id="error-message-box" class="error-message"><p id="error-text">An error occurred.</p></div>

    <script>
        const API_KEY = 'a3af77f2f03f42cbbe335101250306';
        const loadingOverlay = document.getElementById('loading-overlay');
        const errorMessageBox = document.getElementById('error-message-box');
        const errorTextElement = document.getElementById('error-text');

        const elements = { /* ... (same elements object) ... */
            currentWeatherSection: document.getElementById('current-weather-section'),
            locationName: document.getElementById('location-name-display'),
            currentDateTime: document.getElementById('current-datetime-display'),
            mainWeatherIcon: document.getElementById('main-weather-icon-display'),
            currentTemperature: document.getElementById('current-temperature-display'),
            currentCondition: document.getElementById('current-condition-display'),
            feelsLike: document.getElementById('feels-like-display'),
            wind: document.getElementById('wind-display'),
            humidity: document.getElementById('humidity-display'),
            rainToday: document.getElementById('rain-today-display'),
            pressure: document.getElementById('pressure-display'),
            uvIndex: document.getElementById('uv-index-display'),
            hourlyList: document.getElementById('hourly-forecast-list-display'),
            dailyGrid: document.getElementById('daily-forecast-grid-display'),
            searchInput: document.getElementById('location-search-input'),
            searchButton: document.getElementById('search-button'),
            geolocationButton: document.getElementById('geolocation-button')
        };

        const weatherConditionMap = { /* ... (same simplified map, only iconId needed) ... */
            1000: { iconId: 'icon-sun' }, 1003: { iconId: 'icon-cloud-sun' },
            1006: { iconId: 'icon-cloud' }, 1009: { iconId: 'icon-cloud' },
            1030: { iconId: 'icon-cloud' }, 1063: { iconId: 'icon-showers' },
            1066: { iconId: 'icon-snow' }, 1069: { iconId: 'icon-rain' },
            1072: { iconId: 'icon-rain' }, 1087: { iconId: 'icon-thunderstorm' },
            1114: { iconId: 'icon-snow' }, 1117: { iconId: 'icon-snow' },
            1135: { iconId: 'icon-cloud' }, 1147: { iconId: 'icon-cloud' },
            1150: { iconId: 'icon-showers' }, 1153: { iconId: 'icon-showers' },
            1168: { iconId: 'icon-rain' }, 1171: { iconId: 'icon-rain' },
            1180: { iconId: 'icon-showers' }, 1183: { iconId: 'icon-rain' },
            1186: { iconId: 'icon-rain' }, 1189: { iconId: 'icon-rain' },
            1192: { iconId: 'icon-rain' }, 1195: { iconId: 'icon-rain' },
            1198: { iconId: 'icon-rain' }, 1201: { iconId: 'icon-rain' },
            1204: { iconId: 'icon-rain' }, 1207: { iconId: 'icon-rain' },
            1210: { iconId: 'icon-snow' }, 1213: { iconId: 'icon-snow' },
            1216: { iconId: 'icon-snow' }, 1219: { iconId: 'icon-snow' },
            1222: { iconId: 'icon-snow' }, 1225: { iconId: 'icon-snow' },
            1237: { iconId: 'icon-snow' }, 1240: { iconId: 'icon-showers' },
            1243: { iconId: 'icon-showers' }, 1246: { iconId: 'icon-showers' },
            1249: { iconId: 'icon-rain' }, 1252: { iconId: 'icon-rain' },
            1255: { iconId: 'icon-snow' }, 1258: { iconId: 'icon-snow' },
            1261: { iconId: 'icon-snow' }, 1264: { iconId: 'icon-snow' },
            1273: { iconId: 'icon-thunderstorm' }, 1276: { iconId: 'icon-thunderstorm' },
            1279: { iconId: 'icon-thunderstorm' }, 1282: { iconId: 'icon-thunderstorm' },
            night_default: { iconId: 'icon-cloud' },
            default: { iconId: 'icon-default' }
        };

        function getMappedWeather(conditionCode, isDay) { /* ... (same logic as before) ... */
            const condition = weatherConditionMap[conditionCode];
            if (!isDay) {
                if (condition && condition.iconId === 'icon-sun') {
                    return weatherConditionMap.night_default || weatherConditionMap.default;
                }
            }
            return condition || weatherConditionMap.default;
        }

        function createSvgIcon(iconId) { /* ... (ensure it's the full, correct version) ... */ }
        function showLoading() { /* ... (same as previous) ... */ }
        function hideLoading() { /* ... (same as previous) ... */ }

        function showError(message) {
            errorTextElement.textContent = message;
            errorMessageBox.style.display = 'flex';
            hideLoading();
            setTimeout(() => errorMessageBox.style.display = 'none', 2000); // ERROR MESSAGE DURATION SET TO 2 SECONDS
        }

        async function fetchWeatherData(query) { /* ... (same as previous with detailed logging) ... */ }
        function updateUI(data) { /* ... (same as previous, no dynamic bg/text color changes for hero) ... */ }

        // --- Ensure all utility functions and event listeners are complete and correct ---
        function createSvgIcon(iconId) {
            const svgSymbol = document.querySelector(`#${iconId}`);
            if (!svgSymbol) {
                console.warn(`SVG symbol with id "${iconId}" not found. Using default.`);
                const defaultSymbol = document.querySelector('#icon-default');
                if (!defaultSymbol) { const div = document.createElement('div'); div.textContent = '⚠️'; return div; }
                const defaultSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                defaultSvg.setAttribute('viewBox', defaultSymbol.getAttribute('viewBox') || '0 0 24 24');
                defaultSvg.innerHTML = `<use xlink:href="#icon-default"></use>`;
                return defaultSvg;
            }
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', svgSymbol.getAttribute('viewBox') || '0 0 24 24');
            svg.innerHTML = `<use xlink:href="#${iconId}"></use>`;
            return svg;
        }
        function showLoading() { loadingOverlay.style.display = 'flex'; }
        function hideLoading() { loadingOverlay.style.display = 'none'; }
        // showError is already defined above with 2000ms timeout

        async function fetchWeatherData(query) {
            console.log(`[FETCH] Attempting to fetch weather for query: "${query}"`);
            showLoading();
            const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${query}&days=10&aqi=no&alerts=no`;
            try {
                console.log(`[FETCH] Requesting URL: ${url}`);
                const response = await fetch(url);
                console.log(`[FETCH] Response status: ${response.status}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: { message: "API error response is not valid JSON." }}));
                    console.error('[FETCH] API Error Data:', errorData);
                    throw new Error(errorData.error && errorData.error.message ? errorData.error.message : `API request failed with status: ${response.status}`);
                }
                const data = await response.json();
                console.log("[FETCH] Data received, calling updateUI.");
                updateUI(data);
            } catch (error) {
                console.error('[FETCH] Catch block error:', error);
                showError(error.message || 'Could not fetch weather data. Please try again or check the location.');
            } finally {
                console.log("[FETCH] Finally block: Hiding loading.");
                hideLoading();
            }
        }

        function updateUI(data) {
            const { location, current, forecast } = data;
            const currentMappedWeather = getMappedWeather(current.condition.code, current.is_day);

            elements.mainWeatherIcon.innerHTML = '';
            elements.mainWeatherIcon.appendChild(createSvgIcon(currentMappedWeather.iconId));

            elements.locationName.textContent = `${location.name}, ${location.region || location.country}`;
            elements.currentDateTime.textContent = new Date(location.localtime_epoch * 1000).toLocaleString('en-GB', {
                weekday: 'long', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });
            elements.currentTemperature.textContent = `${Math.round(current.temp_c)}°C`;
            elements.currentCondition.textContent = current.condition.text;
            elements.feelsLike.textContent = `${Math.round(current.feelslike_c)}°C`;
            elements.wind.textContent = `${Math.round(current.wind_mph)} mph ${current.wind_dir}`;
            elements.humidity.textContent = `${current.humidity}%`;
            elements.rainToday.textContent = `${forecast.forecastday[0].day.daily_chance_of_rain}%`;
            elements.pressure.textContent = `${Math.round(current.pressure_mb)} mb`;
            elements.uvIndex.textContent = current.uv;

            elements.hourlyList.innerHTML = '';
            const nowEpoch = Math.floor(Date.now() / 1000);
            let hoursDisplayed = 0;
            forecast.forecastday.slice(0, 2).forEach(day => {
                if (hoursDisplayed >= 12) return;
                day.hour.forEach(hour => {
                    if (hour.time_epoch > nowEpoch && hoursDisplayed < 12) {
                        const hourlyMappedWeather = getMappedWeather(hour.condition.code, hour.is_day);
                        const hourCard = document.createElement('div');
                        hourCard.className = 'hour-card';
                        hourCard.innerHTML = `
                            <div class="time">${new Date(hour.time_epoch * 1000).toLocaleTimeString('en-GB', { hour: 'numeric', hour12: true }).toLowerCase()}</div>
                            <div class="icon"></div>
                            <div class="temp">${Math.round(hour.temp_c)}°C</div>
                            <div class="pop">💧 ${hour.chance_of_rain}%</div>
                        `;
                        hourCard.querySelector('.icon').appendChild(createSvgIcon(hourlyMappedWeather.iconId));
                        elements.hourlyList.appendChild(hourCard);
                        hoursDisplayed++;
                    }
                });
            });
             if (hoursDisplayed === 0 && elements.hourlyList.innerHTML === '') {
                elements.hourlyList.innerHTML = `<p style="padding:10px; color: var(--text-global-secondary);">No further hourly forecast available for today.</p>`;
            }

            elements.dailyGrid.innerHTML = '';
             if (!forecast.forecastday || forecast.forecastday.length === 0) {
                elements.dailyGrid.innerHTML = `<p style="padding:10px; color: var(--text-global-secondary); grid-column: 1 / -1;">Daily forecast data not available for this location.</p>`;
                return;
            }
            forecast.forecastday.forEach(dayData => {
                const dailyMappedWeather = getMappedWeather(dayData.day.condition.code, 1);
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.innerHTML = `
                    <div class="day-name">${new Date(dayData.date_epoch * 1000).toLocaleDateString('en-GB', { weekday: 'short' })}</div>
                    <div class="date">${new Date(dayData.date_epoch * 1000).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' })}</div>
                    <div class="icon"></div>
                    <div class="temps">
                        <span class="high">${Math.round(dayData.day.maxtemp_c)}°</span>/<span class="low">${Math.round(dayData.day.mintemp_c)}°</span>
                    </div>
                    <div class="condition-daily">${dayData.day.condition.text}</div>
                `;
                dayCard.querySelector('.icon').appendChild(createSvgIcon(dailyMappedWeather.iconId));
                elements.dailyGrid.appendChild(dayCard);
            });
            if (forecast.forecastday.length < 10 && forecast.forecastday.length >=1) {
                 const notice = document.createElement('p');
                 notice.style.cssText = "padding:10px; color: var(--text-global-secondary); grid-column: 1 / -1; font-size: 0.85em; text-align: center;";
                 notice.textContent = `Displaying ${forecast.forecastday.length}-day forecast. API plan may limit to fewer than 10 days.`;
                 elements.dailyGrid.appendChild(notice);
            }
        }

        elements.searchButton.addEventListener('click', () => { const query = elements.searchInput.value.trim(); if (query) fetchWeatherData(query); else showError("Please enter a location to search."); });
        elements.searchInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') { elements.searchButton.click(); } });

        elements.geolocationButton.addEventListener('click', () => {
            console.log("[GEO] Geolocation button clicked");
            if (navigator.geolocation) {
                // No showLoading() here; fetchWeatherData will handle it.
                console.log("[GEO] Requesting geolocation permission/position...");
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log("[GEO] Geolocation success. Position acquired:", position.coords);
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        console.log(`[GEO] Calling fetchWeatherData for: ${lat},${lon}`);
                        fetchWeatherData(`${lat},${lon}`);
                    },
                    (error) => {
                        console.error('[GEO] Geolocation Error Code:', error.code, 'Message:', error.message);
                        let errorMessage = 'Could not get your location. Please ensure location services are enabled and permissions granted, or search manually.';
                        if (error.code === error.PERMISSION_DENIED) {
                            errorMessage = 'Location permission denied by user. Please enable it in your browser settings or site permissions and try again.';
                        } else if (error.code === error.POSITION_UNAVAILABLE) {
                            errorMessage = 'Location information is currently unavailable. Please try again later or search manually.';
                        } else if (error.code === error.TIMEOUT) {
                            errorMessage = 'The request to get your location timed out. Please try again.';
                        }
                        showError(errorMessage);
                    },
                    { // Optional: PositionOptions
                        enableHighAccuracy: false,
                        timeout: 10000, // 10 seconds
                        maximumAge: 0 // Force fresh position
                    }
                );
            } else {
                console.log("[GEO] Geolocation not supported by this browser.");
                showError('Geolocation is not supported by your browser.');
            }
        });

        document.getElementById('current-year').textContent = new Date().getFullYear();
        fetchWeatherData('Yeovil');

    </script>
</body>
</html>