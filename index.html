<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherAPI Key Test on Vercel</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        h1 { color: #333; }
        #status { margin-top: 20px; padding: 15px; border: 1px solid #ddd; background-color: #fff; }
        .success { color: green; border-color: green; }
        .error { color: red; border-color: red; }
        pre { background-color: #eee; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <h1>Testing WeatherAPI Fetch on Vercel</h1>
    <p>This page will attempt to fetch weather data for Yeovil using a hardcoded API key and display status messages.</p>

    <div id="status">
        <p>Attempting to fetch weather data...</p>
    </div>

    <div id="apiResponse" style="display:none;">
        <h2>API Response:</h2>
        <pre></pre>
    </div>

    <script>
        // Ensure this API key is EXACTLY correct
        const MY_API_KEY = 'a3af77f2f03f42cbbe335101250306'; // Aapki API Key
        const LOCATION = 'Yeovil';
        const DAYS = '3'; // Keep it simple for testing

        const statusElement = document.getElementById('status');
        const apiResponseElement = document.getElementById('apiResponse');
        const apiResponsePre = apiResponseElement.querySelector('pre');

        async function testWeatherApi() {
            const apiUrl = `https://api.weatherapi.com/v1/forecast.json?q=${LOCATION}&days=${DAYS}&key=${MY_API_KEY}`;
            
            statusElement.innerHTML = `<p>Fetching from: ${apiUrl}</p><p>Please wait...</p>`;
            console.log("Attempting to fetch from:", apiUrl);

            try {
                const response = await fetch(apiUrl);
                
                statusElement.innerHTML += `<p>Fetch attempt made. Response status: ${response.status}</p>`;
                console.log("Response Status:", response.status);
                console.log("Response OK:", response.ok);

                const responseText = await response.text(); // Get raw text first for debugging
                console.log("Raw Response Text:", responseText);


                if (!response.ok) {
                    // Try to parse as JSON if it's an API error, otherwise show text
                    let errorData;
                    try {
                        errorData = JSON.parse(responseText);
                        console.error('API Error Data (parsed):', errorData);
                        throw new Error(`API Error ${response.status}: ${errorData.error ? errorData.error.message : response.statusText}. Raw: ${responseText}`);
                    } catch (e) {
                        console.error('Could not parse error response as JSON. Raw response shown above.');
                        throw new Error(`HTTP Error ${response.status}: ${response.statusText}. Raw response: ${responseText}`);
                    }
                }
                
                // If response.ok is true, try to parse as JSON
                const data = JSON.parse(responseText);
                console.log('Successfully fetched and parsed data:', data);

                statusElement.innerHTML = '<p class="success">SUCCESS: Weather data fetched and parsed successfully!</p>';
                statusElement.innerHTML += `<p>Location: ${data.location.name}, ${data.location.country}</p>`;
                statusElement.innerHTML += `<p>Current Temp: ${data.current.temp_c}Â°C</p>`;
                
                apiResponsePre.textContent = JSON.stringify(data, null, 2);
                apiResponseElement.style.display = 'block';

            } catch (error) {
                console.error('Fetch Error:', error);
                statusElement.innerHTML = `<p class="error">ERROR: Could not fetch weather data.</p>`;
                statusElement.innerHTML += `<p>Details: ${error.message}</p>`;
                statusElement.innerHTML += `<p>Check the browser console (F12) for more details, especially the Network tab.</p>`;
                
                // Display raw response text if available in error message and not already shown
                if (error.message && error.message.includes("Raw response:") && apiResponsePre) {
                     apiResponsePre.textContent = "Error occurred. See console for raw response if captured during error.";
                     apiResponseElement.style.display = 'block';
                } else if (error.message && apiResponsePre) {
                    apiResponsePre.textContent = error.message;
                    apiResponseElement.style.display = 'block';
                }

            }
        }

        // Run the test on page load
        testWeatherApi();

    </script>

</body>
</html>
